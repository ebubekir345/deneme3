name: WebAPI Pipeline Template

description: WebAPI'nin çeşitli ortamlara dağıtımı için genel bir şablon.

inputs:
  artifactName:
    description: 'Artifaktın adı'
    required: true
    type: string
  deployToInt:
    description: 'Int ortamına dağıt'
    required: true
    type: boolean
    default: true
  deployToTest:
    description: 'Test ortamına dağıt'
    required: true
    type: boolean
    default: true
  deployToTest01:
    description: 'Test01 ortamına dağıt'
    required: true
    type: boolean
    default: true
  deployToTest02:
    description: 'Test02 ortamına dağıt'
    required: true
    type: boolean
    default: true
  deployToAutomation:
    description: 'Automation ortamına dağıt'
    required: true
    type: boolean
    default: true

runs:
  using: "composite"
  steps:
    - name: Kodu Checkout Et
      uses: actions/checkout@v3

    - name: Değişkenleri Al
      id: variables
      uses: ./.github/actions/Templates/variables/webapi

    - name: WebAPI'yi Derle
      uses: ./.github/actions/Templates/build/webapi

    - name: Int Ortamına Dağıtım
      if: ${{ inputs.deployToInt }}
      uses: ./.github/actions/Templates/deploy/webapi
      with:
        environment: 'int'
        artifactName: ${{ steps.variables.outputs.ARTIFACT_NAME }}
        awsRegion: ${{ steps.variables.outputs.AWS_REGION }}
        imageName: ${{ steps.variables.outputs.IMAGE_NAME }}
        repositoryName: ${{ steps.variables.outputs.REPOSITORY_NAME }}

    - name: Test Ortamına Dağıtım
      if: ${{ inputs.deployToTest }}
      uses: ./.github/actions/Templates/deploy/webapi
      with:
        environment: 'test'
        artifactName: ${{ steps.variables.outputs.ARTIFACT_NAME }}
        awsRegion: ${{ steps.variables.outputs.AWS_REGION }}
        imageName: ${{ steps.variables.outputs.IMAGE_NAME }}
        repositoryName: ${{ steps.variables.outputs.REPOSITORY_NAME }}

    - name: Test01 Ortamına Dağıtım
      if: ${{ inputs.deployToTest01 }}
      uses: ./.github/actions/Templates/deploy/webapi
      with:
        environment: 'test01'
        artifactName: ${{ steps.variables.outputs.ARTIFACT_NAME }}
        awsRegion: ${{ steps.variables.outputs.AWS_REGION }}
        imageName: ${{ steps.variables.outputs.IMAGE_NAME }}
        repositoryName: ${{ steps.variables.outputs.REPOSITORY_NAME }}

    - name: Test02 Ortamına Dağıtım
      if: ${{ inputs.deployToTest02 }}
      uses: ./.github/actions/Templates/deploy/webapi
      with:
        environment: 'test02'
        artifactName: ${{ steps.variables.outputs.ARTIFACT_NAME }}
        awsRegion: ${{ steps.variables.outputs.AWS_REGION }}
        imageName: ${{ steps.variables.outputs.IMAGE_NAME }}
        repositoryName: ${{ steps.variables.outputs.REPOSITORY_NAME }}

    - name: Automation Ortamına Dağıtım
      if: ${{ inputs.deployToAutomation }}
      uses: ./.github/actions/Templates/deploy/webapi
      with:
        environment: 'automation'
        artifactName: ${{ steps.variables.outputs.ARTIFACT_NAME }}
        awsRegion: ${{ steps.variables.outputs.AWS_REGION }}
        imageName: ${{ steps.variables.outputs.IMAGE_NAME }}
        repositoryName: ${{ steps.variables.outputs.REPOSITORY_NAME }}
